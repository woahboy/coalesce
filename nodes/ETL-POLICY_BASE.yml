fileVersion: 1
id: 9fc55fba-acc8-41e2-8685-897925c4b69c
name: POLICY_BASE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: ETL
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 40b37de8-59f7-4737-ad54-bb93ea2ddbb8
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: POLICY_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee8a84d2-12b6-49bf-8a54-a82b38a3229a
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 84d4e46f-aa4d-4c34-8286-481acf512eb1
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: EXTRACT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f89ba369-6ac7-4a3c-9a30-49e7c67e4d68
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 598618fe-eb97-4c4b-9069-9a93d61ae9e9
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: POLICY_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe2088cf-bcdb-4349-a58b-ad4a97a8c1fa
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: IFNULL(TRIM("S_DIM_POLICY"."AGENCY_SYSTEM_POLICY_ID"), '')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b56523d2-48cf-4ba5-bbfa-2683738385ae
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: OFFICE_AGENCY_SYSTEM_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7eca1d63-0229-4dd5-9257-c495b95468e2
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c74d717-bfdf-4b3d-bbfe-5d6014d7a1c7
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CLIENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78ede5ce-75fa-4adc-a047-add4d00bb629
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f51c54c-b7be-444b-82c3-e311e5973e35
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: BROKER_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: afc99a6b-5199-48dc-9e39-b4719a6a7998
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 13f01528-8916-450b-a764-fb58d22a49f7
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: INSURER_MARKET_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c90a6c10-409f-45dc-a8c2-808625113e4b
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c86facb3-34ea-41af-a349-7c9e046e1681
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PAYEE_MARKET_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4902839a-2d58-4011-b6c2-5a410d320b39
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b57015fd-9ebb-428d-90a8-665446b60279
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PRODUCT_LINE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 48c926c5-6144-49bc-9a23-72bcb207a3c1
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77f5cb68-f974-4e48-bc96-dd38812544e2
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PRODUCER1_EMPLOYEE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c5c070c9-c2c1-4c3d-a313-aa24d64a6d4b
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78b81535-74e3-4d22-bf2d-2d1d19f2d827
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PRODUCER2_EMPLOYEE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 520de2e3-8a99-47a3-b73e-eff1af2281a6
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c7019e4-eb02-4122-94a3-62847d6212a4
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CSR1_EMPLOYEE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3ba54c63-bc70-4da8-ba37-0ee40443d3f5
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8949bba3-f79c-40de-968e-20d21d4b6b51
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: DEPARTMENT_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52454ab2-122b-49b3-9b16-b34c5c0f4ea4
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd9cfcca-9e6a-4e38-8bfa-4e3138f22dd6
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: POLICY_NUM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5a5763af-1a86-40d4-89d8-03b96c864216
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dccdab2b-d781-4f28-b5c3-93fdea489cf9
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: POLICY_STATUS
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a73d93a7-0fa1-4116-a084-f3929d16d271
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 58e39d62-2d34-4d42-a12e-6a8945045f3a
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: EFFECTIVE_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 19eefbc1-e8fc-4134-9d28-cdf484d46c45
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: NULLIF(TO_DATE("S_DIM_POLICY"."EFFECTIVE_DATE"), '1900-01-01 00:00:00.000')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49dafcbf-4fb1-4e98-b2bd-ab630b10931c
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: EXPIRATION_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b9ffc88d-ecd4-44f0-b29a-add07a8f6faf
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: NULLIF(TO_DATE("S_DIM_POLICY"."EXPIRATION_DATE"), '1900-01-01 00:00:00.000')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 70694afd-7286-4727-961e-0ef1a33db2b4
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: INCEPTION_DATE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 775e8f9a-6d00-4cdd-bf1d-2aa22cfaaa17
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: NULLIF(TO_DATE("S_DIM_POLICY"."INCEPTION_DATE"), '1900-01-01 00:00:00.000')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42bf3e7d-4a78-49be-a501-aee1b4f922eb
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(19,4)
        description: ""
        name: ESTIMATED_PREMIUM_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7905537e-13e0-439f-ae9f-5fa39db8504e
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de2de286-e865-49f8-bcb4-0186120c49d1
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: EPIC_POLICY_TYPE_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0293579-18b0-4188-9ee1-dd7f1e05c20f
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3dc0ce12-7f1a-4bcf-8885-4906f88791d7
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(19,4)
        description: ""
        name: ANNUALIZED_ENDORSEMENT_PREMIUM_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 456e8d31-bb61-4fa1-a234-c49e189b7fbb
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f50b406b-1787-4fbb-9fc9-79d6246c23e9
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(19,4)
        description: ""
        name: WRITTEN_PREMIUM_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1035d11-0fff-4318-b034-c6003ee39699
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4cd6f4fa-4535-4ee0-816c-b25a96f9fe87
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(19,4)
        description: ""
        name: ANNUALIZED_PREMIUM_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6984c2e6-651d-4121-9364-a0368e5ca540
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12996ae7-e64e-4308-97d0-ca2011596b50
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: CONTRACTED_EXPIRATION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 003f8672-900d-48ab-8323-08cf9267d3ec
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: NULLIF(TO_DATE("S_DIM_POLICY"."CONTRACTED_EXPIRATION_DATE"), '1900-01-01 00:00:00.000')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bab42828-28a0-4f3d-a749-03924da30938
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: AGENCY_SYSTEM_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c9b3dd0-02a7-4300-8cf3-c454ad8dba36
                stepCounter: d5c3b000-8e70-41a1-911e-1711ea6ad5d9
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87bbe71c-2850-421d-9af9-712a738992c9
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: BILL_TYPE_KEY
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0d9302dc-6b99-4768-9ea9-3e5c2c5feff6
                stepCounter: b5ebe4ea-2a2b-4803-809f-ad3abd50eade
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 282b6621-1e16-43a5-b344-ec53c6c53ff6
          stepCounter: 9fc55fba-acc8-41e2-8685-897925c4b69c
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: SOURCE_SYSTEM_INSTANCE_CODE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c9b3dd0-02a7-4300-8cf3-c454ad8dba36
                stepCounter: d5c3b000-8e70-41a1-911e-1711ea6ad5d9
            transform: "\"S_DIM_EXTRACT\".\"AGENCY_SYSTEM_NAME\" || ' - ' || TO_CHAR(\"S_DIM_EXTRACT\".\"OFFICE_AGENCY_SYSTEM_KEY\")"
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: OS1_FDW
            nodeName: S_DIM_EXTRACT
          - locationName: OS1_FDW
            nodeName: S_DIM_POLICY
        join:
          joinCondition: |-
            FROM {{ ref('OS1_FDW', 'S_DIM_POLICY') }} "S_DIM_POLICY"
            INNER JOIN {{ ref('OS1_FDW', 'S_DIM_EXTRACT') }} "S_DIM_EXTRACT"
            ON "S_DIM_POLICY"."EXTRACT_KEY" = "S_DIM_EXTRACT"."EXTRACT_KEY"
            WHERE "S_DIM_POLICY"."OFFICE_AGENCY_SYSTEM_KEY" = {{parameters.FDW_oas_id_EPIC_US}}
            AND IFNULL(TRIM("S_DIM_POLICY"."AGENCY_SYSTEM_POLICY_ID"), '') <> ''
            QUALIFY ROW_NUMBER() OVER
                (
                    PARTITION BY
                        TRIM("S_DIM_POLICY"."AGENCY_SYSTEM_POLICY_ID"), 
                        "S_DIM_POLICY"."OFFICE_AGENCY_SYSTEM_KEY"
                    ORDER BY
                        "S_DIM_POLICY"."EXTRACT_KEY" DESC,
                        "S_DIM_POLICY"."POLICY_KEY" DESC
                ) = 1
        name: POLICY_BASE
        noLinkRefs: []
  name: POLICY_BASE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
