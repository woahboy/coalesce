steps:
  DIM_CUSTOMER-1feef31d-8c06-4282-a98f-65369b752b01:
    operation:
      config:
        insertStrategy: UNION
        postSQL: null
        preSQL: null
        selectDistinct: false
        testsEnabled: true
        truncateBefore: true
      database: ""
      deployEnabled: true
      description: Customer data as defined by TPC-H
      isDataVault: false
      isMultisource: false
      locationName: TARGET
      materializationType: table
      metadata:
        appliedNodeTests: []
        columns:
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: f53b17ce-6550-4110-8054-3b502b25ccfc
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            config: {}
            dataType: NUMBER
            defaultValue: ""
            description: ""
            keyColumnType: None
            name: DIM_CUSTOMER_KEY
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: "0"
                    stepCounter: "0"
                transform: ROW_NUMBER() OVER (ORDER BY SYSTEM_UPDATE_DATE)
            systemColumnType: None
            transform: ""
          - columnReference:
              columnCounter: 9f01f9d4-bfaa-4d21-a6e1-79e3fa664603
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: NUMBER(38,0)
            description: ""
            hashColumns: []
            hashDetails: null
            name: C_CUSTKEY
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 4200af30-489f-45d3-bdc2-b2fc71e2b467
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: NVL("STG_HISTORY_CUSTOMER"."C_CUSTKEY", LAG("STG_HISTORY_CUSTOMER"."C_CUSTKEY") IGNORE NULLS OVER (ORDER BY SYSTEM_UPDATE_DATE))
          - columnReference:
              columnCounter: 0817a30f-9b1f-4fd7-9ded-d582e7f34c89
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: VARCHAR(25)
            description: ""
            hashColumns: []
            hashDetails: null
            name: C_NAME
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 9098176f-26bb-4bb3-9f1d-94eb84679104
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: NVL("STG_HISTORY_CUSTOMER"."C_NAME", LAG("STG_HISTORY_CUSTOMER"."C_NAME") IGNORE NULLS OVER (ORDER BY SYSTEM_UPDATE_DATE))
          - columnReference:
              columnCounter: f64650bb-fe16-4be1-bc31-4005c0f5cee3
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: VARCHAR(40)
            description: ""
            hashColumns: []
            hashDetails: null
            name: C_ADDRESS
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 3d65f4fb-f90a-44aa-b982-e7ff771dac35
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: NVL("STG_HISTORY_CUSTOMER"."C_ADDRESS", LAG("STG_HISTORY_CUSTOMER"."C_ADDRESS") IGNORE NULLS OVER (ORDER BY SYSTEM_UPDATE_DATE))
          - acceptedValues:
              strictMatch: false
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 8dfe501b-fd80-421d-9465-a936802370a6
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: NUMBER(38,0)
            description: ""
            name: C_NATIONKEY
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 0f50db98-1279-49ff-ab25-d0ab5d5b19aa
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: NVL("STG_HISTORY_CUSTOMER"."C_NATIONKEY", LAG("STG_HISTORY_CUSTOMER"."C_NATIONKEY") IGNORE NULLS OVER (ORDER BY SYSTEM_UPDATE_DATE))
          - columnReference:
              columnCounter: 0d401a16-b2e4-4646-90fb-f937aa35b9f0
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: VARCHAR(25)
            description: ""
            hashColumns: []
            hashDetails: null
            name: N_NAME
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: fb9271d6-d059-4bd2-8c6c-fd74b34aae36
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: |-
                  NVL(
                      "STG_HISTORY_CUSTOMER"."N_NAME",
                      LAG("STG_HISTORY_CUSTOMER"."N_NAME") IGNORE NULLS OVER (
                        PARTITION BY
                          COALESCE(
                            "STG_HISTORY_CUSTOMER"."C_NATIONKEY",
                            "STG_HISTORY_CUSTOMER"."N_NATIONKEY"
                          )
                        ORDER BY
                          SYSTEM_UPDATE_DATE
                      )
                    )
          - acceptedValues:
              strictMatch: false
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: f431e6aa-40af-4c86-8eb3-ed8c9ef7618b
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: NUMBER(38,0)
            description: ""
            name: N_NATIONKEY
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 14cfca15-c01d-4d33-af7f-76a1cd96763a
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: |-
                  NVL(
                      "STG_HISTORY_CUSTOMER"."N_NATIONKEY",
                      LAG("STG_HISTORY_CUSTOMER"."N_NATIONKEY") IGNORE NULLS OVER (
                        PARTITION BY
                          COALESCE(
                            "STG_HISTORY_CUSTOMER"."C_NATIONKEY",
                            "STG_HISTORY_CUSTOMER"."N_NATIONKEY"
                          )
                        ORDER BY
                          SYSTEM_UPDATE_DATE
                      )
                    )
          - acceptedValues:
              strictMatch: false
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: e2a2af41-216a-47fe-a0ee-5e928eb74d93
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: VARCHAR
            description: ""
            name: SYSTEM_CURRENT_FLAG
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 604092eb-cf82-405b-886d-56f10b55659e
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: ""
          - acceptedValues:
              strictMatch: false
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 3fc18a07-3da3-46ee-b1c8-25b1c4e25975
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: NUMBER
            description: ""
            name: SYSTEM_VERSION
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 25b911b1-639d-4b5f-89d7-eea54ef492bd
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: ""
          - columnReference:
              columnCounter: 5a46f9c6-02c8-4e99-8117-8b0d72b2c334
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: TIMESTAMP
            description: ""
            hashColumns: []
            hashDetails: null
            name: SYSTEM_START_DATE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 2cd90188-493a-4a39-878a-830fb5cdfbf9
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: ""
          - columnReference:
              columnCounter: 1b6c047f-44a8-41ff-b11f-94c841b75a96
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: TIMESTAMP
            description: ""
            hashColumns: []
            hashDetails: null
            name: SYSTEM_END_DATE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: df07de3d-71a1-40f2-8849-222f4eba9e47
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: NVL(LEAD("STG_HISTORY_CUSTOMER"."SYSTEM_START_DATE", 1) OVER (PARTITION BY COALESCE("STG_HISTORY_CUSTOMER"."C_NATIONKEY", "STG_HISTORY_CUSTOMER"."N_NATIONKEY") ORDER BY SYSTEM_UPDATE_DATE), TO_TIMESTAMP('2999-01-01'))
          - columnReference:
              columnCounter: df23fd83-7e65-40ca-9860-1bfade87db07
              stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
            dataType: TIMESTAMP
            description: ""
            hashColumns: []
            hashDetails: null
            name: SYSTEM_UPDATE_DATE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: ba62c9d5-8f95-4f0b-979b-54b65e309da8
                    stepCounter: c2eec3c8-f2bb-46c0-8383-9b63ec563db9
                transform: ""
        cteString: ""
        enabledColumnTestIDs: []
        sourceMapping:
          - aliases: {}
            customSQL:
              customSQL: ""
            dependencies:
              - locationName: TARGET
                nodeName: STG_HISTORY_CUSTOMER
            join:
              joinCondition: |-
                FROM {{ ref('TARGET', 'STG_HISTORY_CUSTOMER') }} "STG_HISTORY_CUSTOMER"
                QUALIFY LAG("STG_HISTORY_CUSTOMER"."C_NATIONKEY", 1) OVER (ORDER BY "STG_HISTORY_CUSTOMER"."SYSTEM_UPDATE_DATE") = "STG_HISTORY_CUSTOMER"."N_NATIONKEY"
                OR "STG_HISTORY_CUSTOMER"."N_NATIONKEY" IS NULL
                OR LAG("STG_HISTORY_CUSTOMER"."C_NATIONKEY", 1) OVER (ORDER BY "STG_HISTORY_CUSTOMER"."SYSTEM_UPDATE_DATE") IS NULL
                ORDER BY SYSTEM_UPDATE_DATE
            name: DIM_CUSTOMER
            noLinkRefs: []
      name: DIM_CUSTOMER
      overrideSQL: false
      schema: ""
      sqlType: Stage
      type: sql
    stepCounter: 1feef31d-8c06-4282-a98f-65369b752b01
